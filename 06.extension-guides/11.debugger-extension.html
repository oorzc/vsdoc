<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://oorzc.cn/06.extension-guides/11.debugger-extension.html"><meta property="og:site_name" content="vscode插件开发文档"><meta property="og:title" content="调试器插件"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/icons/apple-touch-icon.png" type="image/png" sizes="512x512"><link rel="icon" href="/icons/apple-touch-icon.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#fff"><link rel="apple-touch-icon" href="/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/icons/apple-touch-icon.png"><meta name="msapplication-TileColor" content="#ffffff"><title>调试器插件 | vscode插件开发文档</title><meta name="description" content="vscode插件开发文档">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.28776aee.css" as="style" /><link rel="stylesheet" href="/assets/style.28776aee.css" />
    <link rel="modulepreload" href="/assets/app.ed9f300c.js"><link rel="modulepreload" href="/assets/11.debugger-extension.html.de589cec.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/11.debugger-extension.html.ab844e83.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.jpg" alt="vscode插件开发文档"><!----><span class="site-name hide-in-pad">vscode插件开发文档</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!----><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">预备知识</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">api</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">第一步</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">开发插件</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">插件功能</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">插件指南</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/06.extension-guides/01.command.html" class="nav-link sidebar-link sidebar-page" aria-label="命令"><!---->命令<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/02.color-theme.html" class="nav-link sidebar-link sidebar-page" aria-label="色彩主题"><!---->色彩主题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/03.file-icon-theme.html" class="nav-link sidebar-link sidebar-page" aria-label="图标主题"><!---->图标主题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/04.product-icon-theme.html" class="nav-link sidebar-link sidebar-page" aria-label="产品图标主题（预览）"><!---->产品图标主题（预览）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/05.tree-view.html" class="nav-link sidebar-link sidebar-page" aria-label="树视图"><!---->树视图<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/06.webview.html" class="nav-link sidebar-link sidebar-page" aria-label="Webview API"><!---->Webview API<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/07.notebook.html" class="nav-link sidebar-link sidebar-page" aria-label="笔记本 API"><!---->笔记本 API<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/08.virtual-documents.html" class="nav-link sidebar-link sidebar-page" aria-label="虚拟文档"><!---->虚拟文档<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/09.task-provider.html" class="nav-link sidebar-link sidebar-page" aria-label="任务"><!---->任务<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/10.scm-provider.html" class="nav-link sidebar-link sidebar-page" aria-label="源控制API"><!---->源控制API<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="调试器插件"><!---->调试器插件<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#vs-code-中的调试架构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="VS Code 中的调试架构"><!---->VS Code 中的调试架构<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#模拟调试插件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="模拟调试插件"><!---->模拟调试插件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#开发环境配置模拟调试" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="开发环境配置模拟调试"><!---->开发环境配置模拟调试<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#剖析调试器插件的package-json" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="剖析调试器插件的package.json"><!---->剖析调试器插件的package.json<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#使用debugconfigurationprovider" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="使用DebugConfigurationProvider"><!---->使用DebugConfigurationProvider<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#发布调试器插件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="发布调试器插件"><!---->发布调试器插件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#开发调试器插件的其他方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="开发调试器插件的其他方式"><!---->开发调试器插件的其他方式<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/12.markdown-extension.html" class="nav-link sidebar-link sidebar-page" aria-label="Markdown插件"><!---->Markdown插件<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/13.custom-editors.html" class="nav-link sidebar-link sidebar-page" aria-label="自定义编辑器 API"><!---->自定义编辑器 API<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/14.custom-data-extension.html" class="nav-link sidebar-link sidebar-page" aria-label="自定义数据插件"><!---->自定义数据插件<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/06.extension-guides/" class="nav-link sidebar-link sidebar-page" aria-label="插件指南"><!---->插件指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">语言插件</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">进阶主题</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">️️参考</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">其他1</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">其他2</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->调试器插件</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">oorzc</span></span><span property="author" content="oorzc"></span></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 15 分钟</span><meta property="timeRequired" content="PT15M"></span><span class="words-info" aria-label="字数🔠" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 4589 字</span><meta property="wordCount" content="4589"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#vs-code-中的调试架构" class="router-link-active router-link-exact-active toc-link level2">VS Code 中的调试架构</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#模拟调试插件" class="router-link-active router-link-exact-active toc-link level2">模拟调试插件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#开发环境配置模拟调试" class="router-link-active router-link-exact-active toc-link level2">开发环境配置模拟调试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#剖析调试器插件的package-json" class="router-link-active router-link-exact-active toc-link level2">剖析调试器插件的package.json</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#使用debugconfigurationprovider" class="router-link-active router-link-exact-active toc-link level2">使用DebugConfigurationProvider</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#发布调试器插件" class="router-link-active router-link-exact-active toc-link level2">发布调试器插件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/06.extension-guides/11.debugger-extension.html#开发调试器插件的其他方式" class="router-link-active router-link-exact-active toc-link level2">开发调试器插件的其他方式</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="调试器插件" tabindex="-1"><a class="header-anchor" href="#调试器插件" aria-hidden="true">#</a> 调试器插件</h1><p>VS Code已经内置了一套通用的用户界面，插件作者能够通过VS Code的调试架构轻松将已有的调试器整合进来。</p><p>VS Code已经内置了一个<a href="https://nodejs.org/" target="_blank" rel="noopener noreferrer">Node.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>调试器插件，它将成为你学习VS Code调试器特性的绝佳搭档。</p><p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/debugger-extension/debug-features.png" alt="VS Code调试功能"></p><p>上面的截图展示了以下调试功能：</p><ol><li>管理调试器配置</li><li>开始、停止、步进等调试操作</li><li>源、函数、条件断点、行断点和记录点</li><li>支持多线程和多进程的调用栈</li><li>在<em>视图</em>中浏览复杂的数据，鼠标悬停在数据上可以看到更多信息</li><li>鼠标悬停在源代码中可以看到变量的值</li><li>管理watch表达式</li><li>调试控制台支持交互操作，如求值、自动补全等</li></ol><p>本节将帮你创建一个任意调试器都可以和VS Code协作的调试器插件。</p><h2 id="vs-code-中的调试架构" tabindex="-1"><a class="header-anchor" href="#vs-code-中的调试架构" aria-hidden="true">#</a> VS Code 中的调试架构</h2><hr><p>VS Code基于抽象协议，实现了一个原生（非语言相关的）的调试器UI，它可以和任意后台调试程序通信。通常来讲，调试器不会实现这份协议，因此调试器中需要一些中间件去“适配”这个协议。这个中间件一般而言是一个独立和调试器通信的进程。</p><p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/debugger-extension/debug-arch1.png" alt="VS Code的调试架构"></p><p>我们将这个中间件称为<strong>调试适配器（Debug Adapter）</strong>（简写为<strong>DA</strong>），在VS Code和DA之间通信的抽象协议称之为<strong>调试适配器协议(Debug Adapter Protocol)</strong> (简写<strong>DAP</strong>)。调试适配器协议独立于VS Code，它有自己的<a href="https://microsoft.github.io/debug-adapter-protocol/" target="_blank" rel="noopener noreferrer">网站<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，你在上面可以找到相关的<a href="https://microsoft.github.io/debug-adapter-protocol/overview" target="_blank" rel="noopener noreferrer">介绍和概述<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，以及详细的<a href="https://microsoft.github.io/debug-adapter-protocol/specification" target="_blank" rel="noopener noreferrer">说明书<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，上面还列出了一些<a href="https://microsoft.github.io/debug-adapter-protocol/implementors/adapters/" target="_blank" rel="noopener noreferrer">已知实现和支持工具<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，这份努力背后的故事和动机，我们都记录在了<a href="https://code.visualstudio.com/blogs/2018/08/07/debug-adapter-protocol-website#_why-the-need-for-decoupling-with-protocols" target="_blank" rel="noopener noreferrer">博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中。</p><p>因为调试适配器独立于VSCode，所以它可用在<a href="https://microsoft.github.io/debug-adapter-protocol/implementors/tools/" target="_blank" rel="noopener noreferrer">其他开发工具<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中，它们无需匹配VS Code的插件架构，而只需基于插件和<em>发布内容配置</em>即可。</p><p>出于这个原因，VS Code提供了一个配置点<code>debuggers</code>，调试适配器在这里可以配置特定的调试类型（例如：Node.js调试器使用<code>node</code>）。用户只要启动了这个类型的调试适配器会话，VS Code就能加载注册好的调试适配器。</p><p>因此调试适配器的最小形式就是声明一个配置，对应调试适配器的实现，这个插件就是调试适配器的装载容器，而且不需要任何多余的代码。</p><p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/debugger-extension/debug-arch2.png" alt="VS Code调试架构-2"></p><p>一个更贴近现实的调试器插件往往会添加很多配置，如下面的：</p><ul><li>调试器支持的语言。VS Code会为这些语言启用UI界面的断点功能</li><li>由调试器引入的JSON格式的调试配置属性。VS Code会使用这个格式校验launch.json中的配置，并提供补全功能</li><li>首次加载调试时，VS Code自动生成初始launch.json文件</li><li>用户可以给launch.json添加的调试配置片段</li><li>声明调试配置中可以使用的变量</li></ul><p>想要了解更多相关内容，请查看<a href="/extensibility-reference/contribution-points#contributesbreakpoints">contributes.breakpoints</a>和<a href="/extensibility-reference/contribution-points#contributesdebuggers">contributes.debuggers</a>。</p><h2 id="模拟调试插件" tabindex="-1"><a class="header-anchor" href="#模拟调试插件" aria-hidden="true">#</a> 模拟调试插件</h2><hr><p>由于从头开始创建一个调试适配器太繁琐了，所以我们将从简单的DA(我们已经创建过的<strong>入门级调试适配器</strong>)开始。因为它不与真正的调试器进行通信，所以就叫它——<em>模拟调试</em>吧。</p><p><em>模拟调试</em>模拟了调试器功能，支持：</p><ul><li>单步调试</li><li>跳到下一个断点</li><li>断点</li><li>异常</li><li>访问变量</li></ul><p>在深入了解开发中的<em>模拟调试</em>之前，我们先去VS Code插件市场安装个<a href="https://marketplace.visualstudio.com/items?itemName=andreweinand.mock-debug" target="_blank" rel="noopener noreferrer">预构建版本<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>玩一玩，就像下面这样：</p><ul><li>打开VS Code的插件面板，输入&quot;mock&quot;并找到<strong>Mock Debug</strong>插件</li><li><strong>安装</strong>并<strong>重启</strong></li></ul><p>通过如下流程来启动<em>模拟调试</em>：</p><ul><li>新建一个空的文件夹<code>mock test</code>并在VS Code中打开</li><li>创建一个<code>readme.md</code>，在里面随便写点什么东西</li><li>切换到<strong>调试</strong>视图，点一下<strong>齿轮图标</strong></li><li>VS Code会让你选择一个&quot;环境&quot;，并将其作为默认的启动配置。这里选择&quot;Mock Debug&quot;。</li><li>点击绿色的<strong>开始</strong>按钮，然后开始调试</li></ul><p>至此，一个调试会话就开始了，你可以在<code>readme.md</code>文件中进行单步调试、打断点。如果某一行出现异常则会跳进该异常。</p><p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/debugger-extension/mock-debug.gif" alt="模拟运行调试工具"></p><p>在使用<em>模拟调试</em>之前，我们建议你卸载掉<a href="https://marketplace.visualstudio.com/items?itemName=andreweinand.mock-debug" target="_blank" rel="noopener noreferrer">预构建版本<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：</p><ul><li>切换到Extensions视图，然后单击<em>模拟调试</em>插件的齿轮图标</li><li>卸载该插件并重启VS Code</li></ul><h2 id="开发环境配置模拟调试" tabindex="-1"><a class="header-anchor" href="#开发环境配置模拟调试" aria-hidden="true">#</a> 开发环境配置模拟调试</h2><hr><p>现在让我们下载Mock Debug的源码，然后用VS Code进行开发吧：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/Microsoft/vscode-mock-debug.git
<span class="token builtin class-name">cd</span> vscode-mock-debug
<span class="token function">npm</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用VS Code打开<code>vscode-mock-debug</code>项目</p><p>我们的项目里面有什么呢？</p><ul><li><code>package.json</code>是mock-debug插件的配置清单： <ul><li>里面是mock-debug插件的<em>发布内容配置</em>清单</li><li><code>compile</code>和<code>watch</code>脚本会将Typescript源码编译到<code>out</code>文件夹中，然后<code>watch</code>脚本会追踪源码每个细微的修改</li><li><code>vscode-debugprotocol</code>，<code>vscode-debugadapter</code>和<code>vscode-debugadapter-testsupport</code>npm依赖包简化了基于node的调试适配器开发工作</li></ul></li><li><code>src/mockRuntime.ts</code>是一个<strong>模拟的</strong>运行时，仅仅包含一些简单的调试API</li><li><code>src/mockDebug.ts</code>是我们的主要代码，是它将<em>运行时</em>适配到<strong>调试适配器</strong>上。你可以在里面找到各种处理DAP请求的方式。</li><li>调试插件实现于调试适配器，所以你可以完全不使用创建普通插件的代码（比如：原来插件的代码运行在扩展主机环境中），但是mock-debug还是有个小小的<code>src/extension.ts</code>，这份代码里面阐释了调试器插件中<em>插件</em>部分的代码可以做些什么。</li></ul><p>现在构建项目，然后加载Mock Debug插件。选择<strong>调试侧边栏</strong>，加载 <strong>Extension</strong> 配置，然后按下<code>F5</code>。接下来，会启动插件的Typescript编译工作，将转换后的代码输出到<code>out</code>文件夹中，然后进行全量编译，再接着，<em>watcher</em>任务会启动以便侦听你的改动。</p><p>代码编译完成后，带有&quot;[Extension Development Host]&quot;（中文环境下是&quot;[扩展开发主机]&quot;）VS Code新窗口会自动打开，Mock Debug插件就运行在调试模式中了。在这个窗口中，打开<code>mock test</code>项目，打开里面的<code>readme.md</code>，然后直接按下<kbd>F5</kbd>启动调试会话，现在你就可以调试了！</p><p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/debugger-extension/debug-mock-session.png" alt="模拟调试会话"></p><p>因为的你插件运行在 <em>调试模式</em> 中，所以你能在<code>src/extension.ts</code>里面打断点，不过就如上文所说，这个插件关于<em>插件</em>本身的代码是没有多少的，最有意思的代码运行在调试适配器里，它是一个独立的进程。</p><p>要想调试调试适配器本身，我们需要把它运行在调试模式里。最简单的办法就是将调试适配器以<em>服务器模式</em>运行，然后配置VS Code去连接它。在你的vscode-mock-debug项目中，重新在打开的调试侧边栏的配置下拉菜单中选择<em>Server</em>配置，按下旁边的绿色开始按钮。</p><p>因为我们已经启动了一个调试会话，所以VS Code 调试器UI现在会进入 <em>多会话</em> 模式，在**调用栈（CALL STACK）**视图中你现在可以看到2个调试会话—— <strong>Extension</strong> 和 <strong>Server</strong> 。</p><p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/debugger-extension/debugger-extension-server.png" alt="调试插件和服务器"></p><p>现在我们可以同时调试插件和DA（调试适配器）了。到我们目前这一步还有个更快的方式，启动调试时选择<strong>Extension + Server</strong>配置就会自动加载这两个会话。</p><p>另外，调试插件和调试适配器更简单的方式会在<a href="#%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95%E5%99%A8%E6%8F%92%E4%BB%B6%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E5%BC%8F">下面</a>说明。</p><p>在<code>src/mockDebug.ts</code>中的<code>launchRequest(...)</code>最开始的地方打上断点，然后最后一步则是在你的mock test启动配置中添加<code>debugServer</code>属性和对应的端口值<code>4711</code>就完成了调试器和调试适配器的连接。</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mock&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mock test&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${workspaceFolder}/readme.md&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;stopOnEntry&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
			<span class="token property">&quot;debugServer&quot;</span><span class="token operator">:</span> <span class="token number">4711</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你现在就加载这个调试配置，调试适配器不会以分离的进程启动，而是直接连接到已经存在的本地服务器端口4711上。现在你可以在<code>launchRequest</code>打断点了。</p><p>经过这样一连串的配置，你终于可以轻松地编辑、编译和调试Mock Debug插件了。</p><p>但是好戏才刚刚开始：你需要替换<code>src/mockDebug.ts</code>和<code>src/mockRuntime.ts</code>的中的调试适配器代码，让它可以和“真正的”调试器或者运行时通信。这项工作涉及到理解和实现调试适配器协议。</p><p>更多内容请查看<a href="https://microsoft.github.io/debug-adapter-protocol/overview#How_it_works" target="_blank" rel="noopener noreferrer">这里<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h2 id="剖析调试器插件的package-json" tabindex="-1"><a class="header-anchor" href="#剖析调试器插件的package-json" aria-hidden="true">#</a> 剖析调试器插件的package.json</h2><hr><p>除了提供调试适配的特定实现之外，调试器插件还需要一个配置各种各样和调试相关的<code>package.json</code>。</p><p>所以下面我们进一步看看Mock Debug的<code>package.json</code>.</p><p>就像一般的VS Code插件，<code>package.json</code>声明了一些基础信息，如插件的<strong>name</strong> ，<strong>publisher</strong>，<strong>version</strong>等。其中配置<strong>categories</strong>字段可以让你的插件更容易在插件市场中被其他人发现。</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mock-debug&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;displayName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mock Debug&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.24.0&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;publisher&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Starter extension for developing debug adapters for VS Code.&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;engines&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;vscode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.17.0&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.9.0&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/mock-debug-icon.png&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;categories&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Debuggers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

	<span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;breakpoints&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">&quot;language&quot;</span><span class="token operator">:</span> <span class="token string">&quot;markdown&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;debuggers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mock&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mock Debug&quot;</span><span class="token punctuation">,</span>

				<span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./out/mockDebug.js&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;runtime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>

				<span class="token property">&quot;configurationAttributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;launch&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
						<span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;program&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
						<span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
							<span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
								<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
								<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Absolute path to a text file.&quot;</span><span class="token punctuation">,</span>
								<span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${workspaceFolder}/${command:AskForProgramName}&quot;</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span>
							<span class="token property">&quot;stopOnEntry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
								<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">,</span>
								<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Automatically stop after launch.&quot;</span><span class="token punctuation">,</span>
								<span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>

				<span class="token property">&quot;initialConfigurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
					<span class="token punctuation">{</span>
						<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mock&quot;</span><span class="token punctuation">,</span>
						<span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
						<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ask for file name&quot;</span><span class="token punctuation">,</span>
						<span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${workspaceFolder}/${command:AskForProgramName}&quot;</span><span class="token punctuation">,</span>
						<span class="token property">&quot;stopOnEntry&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">]</span><span class="token punctuation">,</span>

				<span class="token property">&quot;configurationSnippets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
					<span class="token punctuation">{</span>
						<span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mock Debug: Launch&quot;</span><span class="token punctuation">,</span>
						<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A new configuration for launching a mock debug program&quot;</span><span class="token punctuation">,</span>
						<span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
							<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mock&quot;</span><span class="token punctuation">,</span>
							<span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
							<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${2:Launch Program}&quot;</span><span class="token punctuation">,</span>
							<span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^\&quot;\\${workspaceFolder}/${1:Program}\&quot;&quot;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">]</span><span class="token punctuation">,</span>

				<span class="token property">&quot;variables&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;AskForProgramName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;extension.mock-debug.getProgramName&quot;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token property">&quot;activationEvents&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;onDebug&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onCommand:extension.mock-debug.getProgramName&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在我们来看看调试器插件中的<code>contributes</code>部分。</p><p>首先，<strong>breakpoints</strong>配置部分列出了可以使用断点的语言列表，没有这个配置的话，就不可能在 Markdown文件中设置断点了。</p><p>接下来是<strong>debuggers</strong>部分，这里引入了一个类型是<code>mock</code>的调试器，用户可以在调试器加载配置中引用这个类型。可选属性<strong>label</strong>是这个调试器的名字，它会显示在UI上。</p><p>因为调试器插件使用了调试适配器，所以它的的关联路径得通过<strong>program</strong>属性配置。为了保证插件的自包含性（self-contained），这个应用必须在我们的插件文件夹中。按惯例，我们将这个应用放在<code>out</code>或者<code>bin</code>中，当然你也可以使用其他名称的文件夹存放。</p><p>因为VS Code运行在不同的平台上，我们需要确保DA程序也能够支持不同的平台。对于这点，我们提供了下列选项：</p><ol><li>如果程序在平台上的实现都是各自独立的，比如：这个程序的运行时支持所有平台，你可以在<strong>runtime</strong>属性中指明。 到目前为止，VS Code支持<code>node</code>和<code>moni</code>运行时，我们的Mock Debug就使用了这个方式。</li><li>如果你的DA在不同的平台上对应着不同的可执行程序，那么你可以这样使用<strong>program</strong>属性：</li></ol><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token property">&quot;debuggers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gdb&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;windows&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./bin/gdbDebug.exe&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;osx&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./bin/gdbDebug.sh&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;linux&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./bin/gdbDebug.sh&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>组合上面两种方式也是可以的。下面的例子实现了在macOS和Linux上使用同一个mono应用，但是Windows上就不是。</li></ol><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token property">&quot;debuggers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mono&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./bin/monoDebug.exe&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;osx&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;runtime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mono&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;linux&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;runtime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mono&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>configurationAttributes</strong>声明了这个调试器的<code>launch.json</code>中的属性可以使用的协议。这个协议用于校验<code>launch.json</code>，同时支持编辑加载配置时的智能补全和悬停帮助。</p><p><strong>initialConfigurations</strong>定义了这个调试器的初始<code>launch.json</code>。当一个项目没有<code>launch.json</code>，然后用户打开了调试会话时，就会使用这个启动配置。然后VS Code会让用户选择一个调试环境，接着再创建对应的<code>launch.json</code>：</p><p><img src="https://media.githubusercontent.com/media/Microsoft/vscode-docs/master/api/extension-guides/images/debugger-extension/debug-init-config.png" alt="调试速选框"></p><p>除了在<code>package.json</code>中静态定义<code>launch.json</code>的初始内容，你还可以使用<code>DebugConfigurationProvider</code>动态注入初始配置内容（详情见下<a href="#%E4%BD%BF%E7%94%A8DebugConfigurationProvider">使用DebugConfigurationProvider</a>）。</p><p><strong>configurationSnippets</strong>定义了编辑<code>launch.json</code>会为用户呈现的代码补全提示。同样，按约定<code>label</code>属性定义了调试环境的名称，所以当大量补全提示出现的时候，用户才能一眼认出自己想要的那个。</p><p><strong>variables</strong>配置，将“变量”绑定到了“命令”上。这些变量会出现在加载配置（launch.json）中，用法是**${command:xyz}**，调试会话启动后，其中的值会被命令中的返回值替换。</p><p><em>命令</em>实现在插件（而不是调试适配器）中，它可以由一句简单的表达式实现，也可以复杂到基于插件API和UI特性实现。Mock Debug将变量<code>AskForProgramName</code>绑定到了命令<code>extension.mock-debug.getProgramName</code>，这个命令的<a href="https://github.com/Microsoft/vscode-mock-debug/blob/606454ff3bd669867a38d9b2dc7b348d324a3f6b/src/extension.ts#L21-L26" target="_blank" rel="noopener noreferrer">实现<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>在<code>src/extension.ts</code>中，代码中的<code>showInputBox</code>允许用户为程序命名：</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">&#39;extension.mock-debug.getProgramName&#39;</span><span class="token punctuation">,</span> config <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">showInputBox</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		placeHolder<span class="token operator">:</span> <span class="token string">&#39;Please enter the name of a markdown file in the workspace folder&#39;</span><span class="token punctuation">,</span>
		value<span class="token operator">:</span> <span class="token string">&#39;readme.md&#39;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在加载配置（launch.json）中可以使用**${command:AskForProgramName}**中的值（文本类型）了。</p><h2 id="使用debugconfigurationprovider" tabindex="-1"><a class="header-anchor" href="#使用debugconfigurationprovider" aria-hidden="true">#</a> 使用DebugConfigurationProvider</h2><hr><p>如果你觉得<code>package.json</code>中和调试相关的发布内容配置不够你用，<code>DebugConfigurationProvider</code>可以动态控制调试插件下列方面的内容：</p><ul><li>动态生成launch.json中的配置。比如：根据工作区的信息生成一些配置。</li><li>在启动新的调试会话前，解析（或修改）加载配置。有了这个功能，你可以根据工作区的不同填入对应的配置默认值。</li></ul><p><code>src/extension.ts</code>中的<code>MockConfigurationProvider</code>实现了<code>resolveDebugConfiguration</code>，它会检测调试会话启动时是不是还没有launch.json文件，而且Markdown文件已经打开了。这种场景非常常见，用户已经打开了文件，他想要立刻启动调试而且不想要搞任何配置。</p><p>通过<code>vscode.debug.registerDebugConfigurationProvider</code>注册<em>调试配置供应器函数</em>，它一般在插件的<code>active</code>函数中。<code>DebugConfigurationProvider</code>需要尽早注册，一旦调试功能被使用到了，插件就应该启动。我们通过<code>package.json</code>中的<code>onDebug</code>事件轻松搞定这个需求：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token property">&quot;activationEvents&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;onDebug&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在低开销的插件启动时（启动时不会花太多时间），这个机制会如预期工作。但是如果插件的启动开销较大（比如启动一个语言服务器），那么<code>onDebug</code>事件可能会对其他调试插件产生副作用，因为<code>onDebug</code>事件已经激活了其他插件，但是其他插件因为阻塞还来不及接收到具体的调试类型。</p><p>对于高开销的调试插件来说，更好的方法就是使用粒度更细的 激活事件：</p><ul><li><code>onDebugInitialConfigurations</code>会在<code>DebugConfigurationProvider</code>的<code>provideDebugConfigurations</code>调用前触发</li><li><code>onDebugResolve:type</code>会在<code>DebugConfigurationProvider</code>的<code>resolveDebugConfiguration</code>取得具体的调试类型前触发</li></ul><p>!&gt; **首要原则：**如果调试插件的开销很小，就用<code>onDebug</code>，根据<code>DebugConfigurationProvider</code>是否实现了<code>provideDebugConfigurations</code>或<code>resolveDebugConfiguration</code>，然后在对应的<code>onDebugInitialConfigurations</code>或者<code>onDebugResolve</code>中处理。</p><h2 id="发布调试器插件" tabindex="-1"><a class="header-anchor" href="#发布调试器插件" aria-hidden="true">#</a> 发布调试器插件</h2><hr><p>通过下面的步骤将你的调试适配器发布到市场上：</p><ul><li>更新<code>package.json</code>中的发布配置内容表明你调试适配器的功能和目标</li><li>参考<a href="/working-with-extensions/publish-extension">发布插件</a>部分然后将你的插件上传到市场上</li></ul><h2 id="开发调试器插件的其他方式" tabindex="-1"><a class="header-anchor" href="#开发调试器插件的其他方式" aria-hidden="true">#</a> 开发调试器插件的其他方式</h2><hr><p>如我们所见，开发一个调试插件涉及到<em>一个普通插件</em>再加上一个调试适配器，它们分别运行在不同的会话中。VS Code支持这样的实现，但是简单的办法是还是把<em>插件</em>和调试适配器用一个程序实现，这样你就可以在一个调试会话中同时调试了。</p><p>实际上，只要你的调试适配器是基于Typescript/Javascript实现的，这个方法就都是可行的。基本的思路是把调试适配器实现为一个服务器，让<em>插件</em>去启动这个服务，再让VS Code连接上去，这样你就不用每个调试会话都启动一个新的调试适配器了。</p><p>Mock Debug的例子阐述了一个<a href="https://github.com/Microsoft/vscode-mock-debug/blob/6a2ef01b95bb22cdf55683f4d616cad501051510/src/extension.ts#L74-L98" target="_blank" rel="noopener noreferrer">DebugAdapterDescriptorFactory<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>可以怎样创建和<a href="https://github.com/Microsoft/vscode-mock-debug/blob/6a2ef01b95bb22cdf55683f4d616cad501051510/src/extension.ts#L32-L36" target="_blank" rel="noopener noreferrer">注册<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>一个基于服务器的调试适配器。通过将编译时的<a href="https://github.com/Microsoft/vscode-mock-debug/blob/6a2ef01b95bb22cdf55683f4d616cad501051510/src/extension.ts#L17" target="_blank" rel="noopener noreferrer"><code>EMBED_DEBUG_ADAPTER</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>配置设置为true启用这个特性。现在如果你用<strong>F5</strong>启动调试，你就不仅仅是在插件开发主机中打了断点，你也同时在调试适配器中打了同样的断点。</p></div><!----><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><a href="/06.extension-guides/10.scm-provider.html" class="nav-link prev" aria-label="源控制API"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->源控制API</div></a><a href="/06.extension-guides/12.markdown-extension.html" class="nav-link next" aria-label="Markdown插件"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">Markdown插件<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a  href='http://beian.miit.gov.cn/' target='_blank'>渝ICP备17004152号-4 | Copyright ©  oorzc</a></div><!----></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.ed9f300c.js" defer></script>
  </body>
</html>
