import{_ as c}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as i,c as u,a as n,b as s,d as t,w as o,e as l,r as p}from"./app.ed9f300c.js";const d={},r=n("h1",{id:"解析插件结构",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#解析插件结构","aria-hidden":"true"},"#"),s(" 解析插件结构")],-1),v=n("p",null,"上一节中，你已经能够自己创建一个基础的插件了，但是在面纱之下，它究竟是怎么运作的呢？",-1),k=n("p",null,[n("code",null,"Hello World"),s("插件包含了3个部分：")],-1),m=n("code",null,"onCommand",-1),_=n("strong",null,"激活事件",-1),h=n("code",null,"onCommand:extension.helloWorld",-1),b=n("code",null,"Hello World",-1),q=n("code",null,"contributes.commands",-1),g=n("strong",null,"发布内容配置",-1),f=n("code",null,"extension.helloWorld",-1),y=n("code",null,"Hello World",-1),x=n("a",{href:"/references/vscode-api#commandsregisterCommand"},[n("code",null,"commands.registerCommand")],-1),C=n("strong",null,"VS Code API",-1),S=n("code",null,"extension.helloWorld",-1),w=n("p",null,"理解下面三个关键概念你才能作出一个基本的插件：",-1),V=n("strong",null,"激活事件",-1),j=n("strong",null,"发布内容配置",-1),I=n("code",null,"package.json",-1),W=n("a",{href:"/get-started/extension-anatomy?id=%E6%8F%92%E4%BB%B6%E6%B8%85%E5%8D%95"},"插件清单",-1),E=n("strong",null,"VS Code API",-1),A=l(`<p>好了，现在让我们自己瞧一瞧<code>Hello World</code>示例的源码部分，以及我们上面提到的3个概念是如何应用其中的。</p><h2 id="插件目录结构" tabindex="-1"><a class="header-anchor" href="#插件目录结构" aria-hidden="true">#</a> 插件目录结构</h2><hr><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>.
├── .vscode
│   ├── launch.json     // 插件加载和调试的配置
│   └── tasks.json      // 配置TypeScript编译任务
├── .gitignore          // 忽略构建输出和node_modules文件
├── README.md           // 一个友好的插件文档
├── src
│   └── extension.ts    // 插件源代码
├── package.json        // 插件配置清单
├── tsconfig.json       // TypeScript配置
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面的几个文件超出了本节讨论的范围，你可以自行前往相应的章节挖掘详细内容：</p>`,5),P=n("code",null,"launch.json",-1),H={href:"https://code.visualstudio.com/docs/editor/debugging",target:"_blank",rel:"noopener noreferrer"},D=n("code",null,"tasks.json",-1),B={href:"https://code.visualstudio.com/docs/editor/tasks",target:"_blank",rel:"noopener noreferrer"},N=n("code",null,"tsconfig.json",-1),T={href:"https://www.typescriptlang.org/docs/handbook/tsconfig-json.html",target:"_blank",rel:"noopener noreferrer"},L=n("p",null,[s("现在，让我们把精力集中在这个插件的关键部分——"),n("code",null,"package.json"),s("和"),n("code",null,"extensions.ts"),s("。")],-1),M=n("h4",{id:"插件清单",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#插件清单","aria-hidden":"true"},"#"),s(" 插件清单")],-1),R=n("code",null,"package.json",-1),F=n("code",null,"package.json",-1),J=n("code",null,"scripts",-1),O=n("code",null,"dependencies",-1),z=n("code",null,"publisher",-1),G=n("code",null,"activationEvents",-1),K=n("code",null,"contributes",-1),Q=n("a",{href:""},"插件清单参考",-1),U=n("li",null,[n("code",null,"name"),s(" 和 "),n("code",null,"publisher"),s(": VS Code 使用"),n("code",null,"<publisher>.<name>"),s("作为一个插件的ID。你可以这么理解，Hello World 例子的 ID 就是"),n("code",null,"vscode-samples.helloworld-sample"),s("。VS Code 使用 ID 来区分各个不同的插件。")],-1),X=n("li",null,[n("code",null,"main"),s(": 插件的主入口。")],-1),Y=n("code",null,"activationEvents",-1),Z=n("code",null,"contributes",-1),$=n("li",null,[n("code",null,"engines.vscode"),s(": 描述了这个插件依赖的最低VS Code API版本。")],-1),nn=n("li",null,[n("code",null,"postinstall"),s(" 脚本: 如果你的"),n("code",null,"engines.vscode"),s("声明的是1.25版的VS Code API，那它就会按照这个声明去安装目标版本。一旦"),n("code",null,"vscode.d.ts"),s("文件存在于"),n("code",null,"node_modules/vscode/vscode.d.ts"),s("，IntelliSense就会开始运作，你就可以对所有VS Code API进行定义跳转或者语法检查了。")],-1),sn=l(`<div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;helloworld-sample&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;displayName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;helloworld-sample&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HelloWorld example for VS Code&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.1&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;publisher&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vscode-samples&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://github.com/Microsoft/vscode-extension-samples/helloworld-sample&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;engines&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;vscode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.25.0&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;categories&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Other&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;activationEvents&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;onCommand:extension.helloWorld&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./out/extension.js&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;commands&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token string">&quot;extension.helloWorld&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;vscode:prepublish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run compile&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;compile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc -p ./&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc -watch -p ./&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;postinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./node_modules/vscode/bin/install&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;@types/node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.10.25&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;tslint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.11.0&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.6.1&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;vscode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.1.22&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="插件入口文件" tabindex="-1"><a class="header-anchor" href="#插件入口文件" aria-hidden="true">#</a> 插件入口文件</h2><hr><p>插件入口文件会导出两个函数，<code>activate</code> 和 <code>deactivate</code>，你注册的<strong>激活事件</strong>被触发之时执行<code>activate</code>，<code>deactivate</code>则提供了插件关闭前执行清理工作的机会。</p>`,4),tn={href:"https://www.npmjs.com/package/vscode",target:"_blank",rel:"noopener noreferrer"},en=n("code",null,"vscode",-1),on=n("code",null,"node ./node_modules/vscode/bin/install",-1),an=n("code",null,"package.json",-1),ln=n("code",null,"engines.vscode",-1),pn=l(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// &#39;vscode&#39;模块包含了VS Code extensibility API</span>
<span class="token comment">// 按下述方式导入这个模块</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> vscode <span class="token keyword">from</span> <span class="token string">&#39;vscode&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 一旦你的插件激活，vscode会立刻调用下述方法</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">activate</span><span class="token punctuation">(</span>context<span class="token operator">:</span> vscode<span class="token punctuation">.</span>ExtensionContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 用console输出诊断信息(console.log)和错误(console.error)</span>
    <span class="token comment">// 下面的代码只会在你的插件激活时执行一次</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Congratulations, your extension &quot;my-first-extension&quot; is now active!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 入口命令已经在package.json文件中定义好了，现在调用registerCommand方法</span>
    <span class="token comment">// registerCommand中的参数必须与package.json中的command保持一致</span>
    <span class="token keyword">let</span> disposable <span class="token operator">=</span> vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">&#39;extension.helloWorld&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 把你的代码写在这里，每次命令执行时都会调用这里的代码</span>
        <span class="token comment">// ...</span>
        <span class="token comment">// 给用户显示一个消息提示</span>
        vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">showInformationMessage</span><span class="token punctuation">(</span><span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    context<span class="token punctuation">.</span>subscriptions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>disposable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function cn(un,dn){const e=p("RouterLink"),a=p("ExternalLinkIcon");return i(),u("div",null,[r,v,k,n("ul",null,[n("li",null,[s("注册"),t(e,{to:"/references/activation-events.html#onCommand"},{default:o(()=>[m]),_:1}),s(),t(e,{to:"/references/activation-events.html"},{default:o(()=>[_]),_:1}),s(": "),h,s("，所以用户可以在输入"),b,s("命令后激活插件。")]),n("li",null,[s("使用"),t(e,{to:"/references/contribution-points.html#contributescommands"},{default:o(()=>[q]),_:1}),s(),t(e,{to:"/references/contribution-points.html"},{default:o(()=>[g]),_:1}),s("，绑定一个命令ID "),f,s("，然后 "),y,s("命令就可以在命令面板中使用了。")]),n("li",null,[s("使用"),x,s(),t(e,{to:"/references/vscode-api.html"},{default:o(()=>[C]),_:1}),s(" 将一个函数绑定到你注册的命令ID"),S,s("上。")])]),w,n("ul",null,[n("li",null,[t(e,{to:"/03.get-started/references/activation-events.html"},{default:o(()=>[V]),_:1}),s(": 插件激活的时机。")]),n("li",null,[t(e,{to:"/03.get-started/references/contribution-points.html"},{default:o(()=>[j]),_:1}),s(": VS Code扩展了 "),I,s(),W,s("的字段以便于开发插件。")]),n("li",null,[t(e,{to:"/03.get-started/references/vscode-api.html"},{default:o(()=>[E]),_:1}),s(": 你的插件代码中需要调用的一系列JavaScript API。")])]),n("p",null,[s("大体上，你的插件就是通过组合发布内容配置和VS Code API扩展VS Code的功能。你能在"),t(e,{to:"/extension-capabilities/"},{default:o(()=>[s("插件功能概述")]),_:1}),s("主题中找到合适你插件的配置点和VS Code API。")]),A,n("ul",null,[n("li",null,[P,s(" 用于配置VS Code "),n("a",H,[s("调试"),t(a)])]),n("li",null,[D,s(" 用于定义VS Code "),n("a",B,[s("任务"),t(a)])]),n("li",null,[N,s(" 参阅TypeScript "),n("a",T,[s("Handbook"),t(a)])])]),L,M,n("p",null,[s("每个VS Code插件都必须包含一个"),R,s("，它就是插件的"),t(e,{to:"/references/extension-manifest.html"},{default:o(()=>[s("配置清单")]),_:1}),s("。"),F,s("混合了Node.js字段，如："),J,s("、"),O,s("，还加入了一些VS Code独有的字段，如："),z,s("、"),G,s("、"),K,s("等。关于这些VS Code字段说明都在"),Q,s("中可以找到。我们在本节介绍一些非常重要的字段：")]),n("ul",null,[U,X,n("li",null,[Y,s(" 和 "),Z,s(": "),t(e,{to:"/references/activation-events.html"},{default:o(()=>[s("激活事件")]),_:1}),s(" and "),t(e,{to:"/references/contribution-points.html"},{default:o(()=>[s("发布内容配置")]),_:1}),s("。")]),$,nn]),sn,n("p",null,[n("a",tn,[en,t(a)]),s("模块包含了一个位于"),on,s("的脚本，这个脚本会拉取"),an,s("中"),ln,s("字段定义的VS Code API。这个脚本执行过后，你就得到了智能代码提示，定义跳转等TS特性了。")]),pn])}const kn=c(d,[["render",cn],["__file","02.extension-anatomy.html.vue"]]);export{kn as default};
