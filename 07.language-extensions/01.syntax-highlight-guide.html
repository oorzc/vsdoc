<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://oorzc.cn/07.language-extensions/01.syntax-highlight-guide.html"><meta property="og:site_name" content="vscode插件开发文档"><meta property="og:title" content="语法高亮"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/icons/apple-touch-icon.png" type="image/png" sizes="512x512"><link rel="icon" href="/icons/apple-touch-icon.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#fff"><link rel="apple-touch-icon" href="/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/icons/apple-touch-icon.png"><meta name="msapplication-TileColor" content="#ffffff"><title>语法高亮 | vscode插件开发文档</title><meta name="description" content="vscode插件开发文档">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.28776aee.css" as="style" /><link rel="stylesheet" href="/assets/style.28776aee.css" />
    <link rel="modulepreload" href="/assets/app.ed9f300c.js"><link rel="modulepreload" href="/assets/01.syntax-highlight-guide.html.781c0986.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/01.syntax-highlight-guide.html.90e5e112.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.jpg" alt="vscode插件开发文档"><!----><span class="site-name hide-in-pad">vscode插件开发文档</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!----><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">预备知识</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">api</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">第一步</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">开发插件</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">插件功能</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">插件指南</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">语言插件</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="语法高亮"><!---->语法高亮<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#分词" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="分词"><!---->分词<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#textmate-语法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="TextMate 语法"><!---->TextMate 语法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#配置基本语法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="配置基本语法"><!---->配置基本语法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#嵌入式语言" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="嵌入式语言"><!---->嵌入式语言<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#开发全新的语法插件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="开发全新的语法插件"><!---->开发全新的语法插件<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#主题化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="主题化"><!---->主题化<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#作用域检查器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="作用域检查器"><!---->作用域检查器<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/07.language-extensions/02.semantic-highlight-guide.html" class="nav-link sidebar-link sidebar-page" aria-label="语义高亮指南"><!---->语义高亮指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/07.language-extensions/03.snippet-guide.html" class="nav-link sidebar-link sidebar-page" aria-label="代码片段"><!---->代码片段<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/07.language-extensions/04.language-configuration-guide.html" class="nav-link sidebar-link sidebar-page" aria-label="语言配置"><!---->语言配置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/07.language-extensions/05.programmatic-language-features.html" class="nav-link sidebar-link sidebar-page" aria-label="程序性语言特性"><!---->程序性语言特性<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/07.language-extensions/06.language-server-extension-guide.html" class="nav-link sidebar-link sidebar-page" aria-label="示例：语言服务器"><!---->示例：语言服务器<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/07.language-extensions/07.embedded-languages.html" class="nav-link sidebar-link sidebar-page" aria-label="嵌入语言"><!---->嵌入语言<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/07.language-extensions/" class="nav-link sidebar-link sidebar-page" aria-label="概述"><!---->概述<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">进阶主题</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">️️参考</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">其他1</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">其他2</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->语法高亮</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">oorzc</span></span><span property="author" content="oorzc"></span></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 11 分钟</span><meta property="timeRequired" content="PT11M"></span><span class="words-info" aria-label="字数🔠" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 3436 字</span><meta property="wordCount" content="3436"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#分词" class="router-link-active router-link-exact-active toc-link level2">分词</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#textmate-语法" class="router-link-active router-link-exact-active toc-link level3">TextMate 语法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#配置基本语法" class="router-link-active router-link-exact-active toc-link level3">配置基本语法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#嵌入式语言" class="router-link-active router-link-exact-active toc-link level3">嵌入式语言</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#开发全新的语法插件" class="router-link-active router-link-exact-active toc-link level3">开发全新的语法插件</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#主题化" class="router-link-active router-link-exact-active toc-link level2">主题化</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/07.language-extensions/01.syntax-highlight-guide.html#作用域检查器" class="router-link-active router-link-exact-active toc-link level2">作用域检查器</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="语法高亮" tabindex="-1"><a class="header-anchor" href="#语法高亮" aria-hidden="true">#</a> 语法高亮</h1><hr><p>语法高亮决定源代码的颜色和样式，它主要负责关键字（如javascript中的<code>if</code>，<code>for</code>）、字符串、注释、变量名等等语法的着色工作。</p><p>语法高亮由两部分工作组成：</p><ul><li><a href="#%E5%88%86%E8%AF%8D">分词</a>：将文本分割为一系列符号（包括单词和标点）</li><li><a href="#%E4%B8%BB%E9%A2%98%E5%8C%96">主题化</a>：然后根据主题或用户设置，对符号进行着色添加样式</li></ul><p>在本章开始之前，建议你先玩一下 <a href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%A3%80%E6%9F%A5%E5%99%A8">作用域检查器</a> 工具看看文件中的符号都长什么样子，他们都应用了哪些主题样式。用内置主题（比如 Dark+）查看一份 TypeScript 文件，你就能同时看到语义高亮和语法高亮了。</p><h2 id="分词" tabindex="-1"><a class="header-anchor" href="#分词" aria-hidden="true">#</a> 分词</h2><hr><p>文本分词是指将文本打碎成一个个片段，并将每个片段根据符号类型（单词、标点等）进行分类。</p><p>VS Code 的分词引擎是通过 <a href="https://macromates.com/manual/en/language_grammars" target="_blank" rel="noopener noreferrer">TextMate<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 驱动的。TextMate 语法是一套使用 plist(XML) 或 JSON 格式的结构化正则表达式集合。VS Code 则可通过 <code>grammar</code> 配置点进行语法配置。</p><p>TextMate 分词引擎和渲染引擎在同一个进程上运行，用户输入时，对应的<strong>符号</strong>也会实时更新。<strong>符号</strong>是语法高亮的最小单位，它将代码分为注释、字符串、正则等类型。</p><p>从1.43 版本开始，VS Code 也允许插件通过 <a href="https://code.visualstudio.com/api/references/vscode-api#DocumentSemanticTokensProvider" target="_blank" rel="noopener noreferrer">语义化分词供应器函数<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 提供分词功能。语义供应器函数通常由语言服务器实现，它必须能够深入理解源代码，并且能够解析上下文的各类符号。比如，一个常量的名称应该在整个项目中都使用常量类型的语法高亮，而不是只在它声明的地方。</p><p>基于语义化分词的语法高亮，一般被认为是基于 TextMate 语言高亮的一个补充。语义化高亮是语法高亮的上层建筑。由于语言服务器通常都要花不少时间加载和分析项目，所以语义化高亮展现也可能会有所延迟。</p><p>本章侧重于介绍基于 TextMate 的分词和语法高亮，语义化分词高亮请查看<a href="/language-extensions/semantic-highlight-guide">语义高亮</a>。</p><h3 id="textmate-语法" tabindex="-1"><a class="header-anchor" href="#textmate-语法" aria-hidden="true">#</a> TextMate 语法</h3><p>VS Code使用<a href="https://macromates.com/manual/en/language_grammars" target="_blank" rel="noopener noreferrer">TextMate 语法<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>将文本分割成一个个符号。TextMate语法是<a href="https://macromates.com/manual/en/regular_expressions" target="_blank" rel="noopener noreferrer">Oniguruma正则表达式<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>的集合，一般是一份plist或者JSON格式的文件。你可以在<a href="https://www.apeth.com/nonblog/stories/textmatebundle.html" target="_blank" rel="noopener noreferrer">这里<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>找到更棒的介绍文档，在里面可以找到你感兴趣的TextMate语法。</p><h4 id="textmate符号和作用域" tabindex="-1"><a class="header-anchor" href="#textmate符号和作用域" aria-hidden="true">#</a> TextMate符号和作用域</h4><p><strong>符号</strong>是由一门编程语言中最常见的一到几个字符组成的。符号包括运算符（如：<code>+</code>和<code>*</code>），变量名（如：<code>myVar</code>），或者字符串（如：<code>&quot;my string&quot;</code>）。</p><p>每个<strong>符号</strong>都有其作用域，作用域描述了这个<strong>符号</strong>的上下文。一个<strong>符号</strong>可被由<strong>点</strong>符号序列查找到，比如javascript中的<code>+</code>符号有这样的作用域<code>keyword.operator.arithmetic.js</code>。</p><p>主题会把颜色和样式映射到作用域上，这样一来就实现了语法高亮。TextMate提供了一些主题中<a href="https://macromates.com/manual/en/language_grammars" target="_blank" rel="noopener noreferrer">常用的作用域<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，如果你想要尽可能全面地支持语法，最好从现成的主题中入手，避免重新编写主题。</p><p><strong>作用域</strong>支持嵌套，每个符号都会关联到它的父作用域上。下面的例子使用了<a href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%A3%80%E6%9F%A5%E5%99%A8">作用域检查器</a>，可以清晰地看到javascript函数中的运算符<code>+</code>和它的作用域层级：</p><p><img src="https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/scopes.png" alt="scopes"></p><p>父作用域的信息也同样是主题中的一部分。当主题指定了作用域，该作用域下的所有符号都会进行对应的着色，除非主题里面对单个作用域有其特殊配置。</p><h3 id="配置基本语法" tabindex="-1"><a class="header-anchor" href="#配置基本语法" aria-hidden="true">#</a> 配置基本语法</h3><p>VS Code支持JSON格式的TextMate语法。你可以在<a href="/references/contribution-points">发布内容配置</a>里面的<code>grammers</code>进行配置。</p><p>这个配置点可以配置的内容有：语言的id，顶层语法作用域的名称，语法文件的路径。下面是一个<code>abc</code>语言的语法配置文件：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;languages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;extensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.abc&quot;</span><span class="token punctuation">]</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;grammars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;language&quot;</span><span class="token operator">:</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;scopeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;source.abc&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./syntaxes/abc.tmGrammar.json&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个语法文件本身包含了一个顶层规则，里面一般分为两个部分，<code>patterns</code>列出了程序(program)和<code>repository</code>的顶层元素。语法中的其他规则需要从<code>repository</code>中使用<code>{ &quot;include&quot;: &quot;#id&quot; }</code>引入。</p><p><code>abc</code>语法标记了字母<code>a</code>，<code>b</code>和<code>c</code>作为关键字，可以被括号包起来成为一个表达式。</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;scopeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;source.abc&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;patterns&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#expression&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;expression&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;patterns&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#letter&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#paren-expression&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;letter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a|b|c&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword.letter&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;paren-expression&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;begin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\\(&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\\)&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;beginCaptures&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;0&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;punctuation.paren.open&quot;</span> <span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token property">&quot;endCaptures&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;0&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;punctuation.paren.close&quot;</span> <span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;expression.group&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;patterns&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#expression&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>语法引擎会试着逐步将<code>expression</code>中的规则应用到文本中。比如下面这个简单的程序：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>a
(
    b
)
x
(
    (
        c
        xyz
    )
)
(
a
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个例子中的语法产生了下面的作用域列表（从左到右，从最佳匹配到最不匹配）</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>a               keyword.letter, source.abc
(               punctuation.paren.open, expression.group, source.abc
    b           expression.group, source.abc
)               punctuation.paren.close, expression.group, source.abc
x               source.abc
(               punctuation.paren.open, expression.group, source.abc
    (           punctuation.paren.open, expression.group, expression.group, source.abc
        c       keyword.letter, expression.group, expression.group, source.abc
        xyz     expression.group, expression.group, source.abc
    )           punctuation.paren.close, expression.group, expression.group, source.abc
)               punctuation.paren.close, expression.group, source.abc
(               source.abc
a               keyword.letter, source.abc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意文本匹配不是单一规则，比如字符串<code>xyz</code>，是包含在当前作用域中的。文件的最后一个括号在<code>expression.group</code>里面，因为不会匹配<code>end</code>规则。</p><h3 id="嵌入式语言" tabindex="-1"><a class="header-anchor" href="#嵌入式语言" aria-hidden="true">#</a> 嵌入式语言</h3><p>如果你的语法中需要在父语言中嵌入其他语言，比如HTML中的CSS，那么你可以使用<code>embeddedLanguages</code>配置，告诉VSCode怎么处理嵌入的语言。然后嵌入语言的括号匹配，注释，和其他基础语言功能都会正常运作。</p><p><code>embeddedLanguages</code>配置将嵌入语言的作用域映射到顶层语言的作用域上。下面里的例子里，<code>meta.embedded.block.javascript</code>作用域中的任何符号都会以javscript处理：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;grammars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./syntaxes/abc.tmLanguage.json&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;scopeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;source.abc&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;embeddedLanguages&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;meta.embedded.block.javascript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;source.js&quot;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，如你对应用了<code>meta.embedded.block.javascript</code>的符号进行注释就会有正确的<code>//</code>javascript风格，如果你触发代码片段，也会提示对应的javascript片段。</p><h3 id="开发全新的语法插件" tabindex="-1"><a class="header-anchor" href="#开发全新的语法插件" aria-hidden="true">#</a> 开发全新的语法插件</h3><p>使用<a href="/get-started/your-first-extension">VS Code的Yeoman模板</a>快速创建一个新的语法插件，运行<code>yo code</code>然后选择<code>New Language</code>：</p><p><img src="https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/yo-new-language.png" alt="yo-new-language"></p><p>Yeoman通过问问题的方式最后生成新的插件，对于创建语法插件最重要的几点就是：</p><ul><li><code>Language Id</code> - 这个语言的id</li><li><code>Language Name</code> - 友好的名称</li><li><code>Scope names</code> - TextMate根作用域名称</li></ul><p><img src="https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/yo-new-language-questions.png" alt="yo-new-language-questions"></p><p>生成器会假设你要同时对新语言定义好语言id和语法。如果你只是根据已有的语言创建新的语法，那么你只要填好目标语言的信息就好，然后一定要删除生成的<code>package.json</code>中的<code>languages</code>部分。</p><p>回答了一大堆问题之后，Yeoman会创建一个新的插件，其结构如下：</p><p><img src="https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/generated-new-language-extension.png" alt="generated-new-language-extension"></p><p>!&gt; 注意：如果你只是配置一个VS Code中已有语言的语法，记得删掉生成的<code>package.json</code>中的<code>languages</code>配置。</p><h4 id="迁移现成的textmate语法" tabindex="-1"><a class="header-anchor" href="#迁移现成的textmate语法" aria-hidden="true">#</a> 迁移现成的TextMate语法</h4><p><code>yo code</code>也快成帮你把已有的TextMate语法转成一个VS Code插件。使用<code>yo code</code>，选择<code>Language extension</code>，当询问是否从已有TextMate文件插件的时候，填入后缀为<code>.tmLanguage</code>或<code>.json</code>的TextMate语法文件。</p><p><img src="https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/yo-convert.png" alt="yo-convert"></p><h4 id="用yaml配置语法" tabindex="-1"><a class="header-anchor" href="#用yaml配置语法" aria-hidden="true">#</a> 用YAML配置语法</h4><p>随着语言日益复杂，你可能很快就会难以理解和维护你的json文件。如果你发现自己需要写很多正则表达式，或是需要添加大量解释语法层面的注释，你可能需要考虑使用yaml定义语法文件了。</p><p>Yaml语法和json有着同样的结构，但是它的语法更加精简，如多行字符串和注释。</p><p><img src="https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/yaml-grammar.png" alt="yaml-grammar"></p><p>VS Code只能加载json语法，所以yaml格式的语法文件必须最终转换成json文件。<a href="https://www.npmjs.com/package/js-yaml" target="_blank" rel="noopener noreferrer"><code>js-yaml</code>包<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>可以帮你完成这个任务：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Install js-yaml as a development only dependency in your extension</span>
$ <span class="token function">npm</span> <span class="token function">install</span> js-yaml --save-dev

<span class="token comment"># Use the command line tool to convert the yaml grammar to json</span>
$ npx js-yaml syntaxes/abc.tmLanguage.yaml <span class="token operator">&gt;</span> syntaxes/abc.tmLanguage.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="语法注入" tabindex="-1"><a class="header-anchor" href="#语法注入" aria-hidden="true">#</a> 语法注入</h4><p>你可以通过<em>语法注入</em>扩展一个现成的语法文件。<em>语法注入</em>就是常规的TextMate语法，<em>语法注入</em>的应用有：</p><ul><li>高亮注释中的关键字，如<code>TODO</code></li><li>对现有语法添加更明确的作用域信息</li><li>向Markdown中的代码区块添加语法高亮</li></ul><p><strong>创建一个基础语法注入</strong></p><p><em>语法注入</em>也是在<code>package.json</code>中配置的，不过这次不需要配置<code>language</code>，而是配置<code>injectTo</code>指明目需要注入的语言作用域列表。</p><p>在这个例子里，我们会新建一个非常简单的注入语法，对javascript注释中的<code>TODO</code>进行高亮。我们在<code>injectTo</code>中用<code>source.js</code>指向目标语言的作用域。</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;grammars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./syntaxes/injection.json&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;scopeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;todo-comment.injection&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;injectTo&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;source.js&quot;</span><span class="token punctuation">]</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除了顶层的<code>injectionSelector</code>，语法本身就应该是标准的TextMate语法。<code>injectionSelector</code>是一个作用域选择器，它指明了<em>语法注入</em>生效的作用域。在我们的例子里，我们想要在所有<code>//</code>注释中的<code>TODO</code>高亮。使用<a href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%A3%80%E6%9F%A5%E5%99%A8">作用域检查器</a>，我们会发现JavaScript的双斜杠存在作用域<code>comment.line.double-slash</code>，所以我们的注入选择器是<code>L:comment.line.double-slash</code>：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;scopeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;todo-comment.injection&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;injectionSelector&quot;</span><span class="token operator">:</span> <span class="token string">&quot;L:comment.line.double-slash&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;patterns&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#todo-keyword&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;todo-keyword&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TODO&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword.todo&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注入选择器中的<code>L:</code>代表注入的语法添加在现有语法规则的左边。也就是说我们注入的语法规则会在任何现有语法规则之前生效。</p><p><strong>嵌入语法</strong></p><p><em>语法注入</em>也可以用在嵌入语言中，在他们的父级语法中进行配置。就和普通的语法意义，<em>语法注入</em>也可以使用<code>embeddedLanguages</code>将嵌入语言的作用域映射到顶层的语言作用域上。</p><p>比如高亮JS字符串中的sql查询的插件，可以使用<code>embeddedLanguages</code>为字符串中所有匹配<code>meta.embedded.inline.sql</code>的符号应用sql语言的基本功能，比如括号匹配和片段选择。</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;grammars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./syntaxes/injection.json&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;scopeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sql-string.injection&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;injectTo&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;source.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token property">&quot;embeddedLanguages&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;meta.embedded.inline.sql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;source.sql&quot;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>符号类型和嵌入语言</strong></p><p>对于嵌入语言中的注入语言还会有个副作用，那就是VS Code把所有字符串（string）中的<em>符号</em>视为字符文本，而且把注释中的所有<em>符号</em>视为符号内容（token content）。 因此诸如括号匹配和自动补全在字符串和注释中是无法使用的，如果<em>嵌入语言</em>刚好出现在字符串或注释中，那么这些功能就无法在<em>嵌入语言</em>中使用。</p><p>想要重载这个行为，你需要使用<code>meta.embedded.*</code>作用域重置VS Code标记字符串和注释行为。最佳实践就是始终将嵌入语言放在<code>meta.embedded.*</code>作用域中，确保VS Code能够正确处理嵌入语言。</p><p>如果你无法为你的语法添加<code>meta.embedded.*</code>作用域，你可以在语法配置中用<code>tokenTypes</code>，指定<em>作用域</em>到内容模式（content mode）上。 下面的<code>tokenTypes</code>确保<code>my.sql.template.string</code>作用域中的任何内容都应视为代码：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;grammars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./syntaxes/injection.json&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;scopeName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sql-string.injection&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;injectTo&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;source.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token property">&quot;embeddedLanguages&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;my.sql.template.string&quot;</span><span class="token operator">:</span> <span class="token string">&quot;source.sql&quot;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token property">&quot;tokenTypes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;my.sql.template.string&quot;</span><span class="token operator">:</span> <span class="token string">&quot;other&quot;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="主题化" tabindex="-1"><a class="header-anchor" href="#主题化" aria-hidden="true">#</a> 主题化</h2><hr><p>主题化是把颜色和样式应用到<strong>符号</strong>的过程。色彩主题定义了主题化规则，但用户可以在<em>用户设置</em>中自定义主题化规则。</p><p><code>tokenColors</code> 定义了 TextMate 主题规则，它的语法和常用的 TextMate 主题是完全一样的。每份规则都定义了 TextMate 作用域选择器，并应用对应的颜色和样式。</p><p>解析符号的颜色或样式时，当前符号的<strong>作用域</strong>需要和规则中的<strong>选择器</strong>相匹配，然后找到最为匹配的样式属性（前景色、加粗、斜体、下划线）。</p><p><a href="/extension-guides/color-theme">色彩主题</a> 章节介绍了如何创建新的色彩主题，语义化分词的主题化则在<a href="/language-extensions/semantic-highlight-guide">语义高亮</a>中。</p><h2 id="作用域检查器" tabindex="-1"><a class="header-anchor" href="#作用域检查器" aria-hidden="true">#</a> 作用域检查器</h2><hr><p>VS Code自带的作用域检查器能帮你调试语法文件。它能显示当前位置<em>符号</em>作用域，以及应用在上面的主题规则和元信息。</p><p>在命令面板中输入<code>Developer: Inspect TM Scopes</code>或者<a href="https://code.visualstudio.com/docs/getstarted/keybindings" target="_blank" rel="noopener noreferrer">使用快捷键<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>启动<em>作用域检查器</em>。</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cmd+alt+shift+i&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token string">&quot;editor.action.inspectTMScopes&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://code.visualstudio.com/assets/api/language-extensions/syntax-highlighting/scope-inspector.png" alt="scope-inspector"></p><p>作用域检查器可以显示以下的信息：</p><ol><li>当前符号</li><li>关于符号的元信息，这些值都是计算后的值。如果你使用了嵌入语言，那么这里最重要的信息就是<code>language</code>和<code>token type</code>了</li><li>符号使用的主题规则。这里只显示当前应用的规则，而不显示被其他样式覆盖的规则。</li><li>完整的作用域列表，越往上作用域越明确。</li></ol></div><!----><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><!----><a href="/07.language-extensions/02.semantic-highlight-guide.html" class="nav-link next" aria-label="语义高亮指南"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">语义高亮指南<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a  href='http://beian.miit.gov.cn/' target='_blank'>渝ICP备17004152号-4 | Copyright ©  oorzc</a></div><!----></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.ed9f300c.js" defer></script>
  </body>
</html>
